<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ AIè©¦é¨“å¯¾ç­–ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
    <meta name="description" content="ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ã®ä½“ç³»æ•°å­¦ãƒ»Progress 21ã«æº–æ‹ ã—ãŸAIå­¦ç¿’ãƒ„ãƒ¼ãƒ«">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã‚«ãƒªã‚¿ã‚¹å­¦ç¿’ãƒ„ãƒ¼ãƒ«">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
    
    <!-- ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuOCq+ODquOCv+ODueS4reWtpuagoSBBSeivlem6k+WvvuetluODhOODvOODqyIsCiAgInNob3J0X25hbWUiOiAi44Kr44Oq44K/44K544Gn44GN44G+44CCIiwKICAiZGVzY3JpcHRpb24iOiAi44Kr44Oq44K/44K55Lit5a2m5qCh44Gu5L2T57O65pWw5a2m44O7UHJvZ3Jlc3MgMjHjgavmupbmjqbjgZfjgZ9BSeWtpuaTjeODhOODvOODqyIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzQjgyRjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7wn5OaPC90ZXh0Pjwvc3ZnPiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLDxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCc+PHRleHQgeT0nLjllbScgZm9udC1zaXplPSc5MCc+8J+TmjwvdGV4dD48L3N2Zz4iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overscroll-behavior: none; /* PWAç”¨ï¼šã‚ªãƒ¼ãƒãƒ¼ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹ */
        }
        
        /* PWAç”¨ï¼šã‚¿ãƒƒãƒ—ãƒã‚¤ãƒ©ã‚¤ãƒˆç„¡åŠ¹ */
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* PWAç”¨ï¼šé¸æŠç„¡åŠ¹ï¼ˆå¿…è¦ãªç®‡æ‰€ä»¥å¤–ï¼‰ */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .install-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¡¨ç¤º */
        .offline-banner {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* ã‚¢ãƒ—ãƒªãƒ©ã‚¤ã‚¯ãªãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: none; /* å¿…è¦ã«å¿œã˜ã¦è¡¨ç¤º */
        }
    </style>
</head>
<body>
    <!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¡¨ç¤ºãƒãƒŠãƒ¼ -->
    <div id="offline-banner" class="offline-banner" style="display: none;">
        ğŸ“± ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ - ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª -->
    <div id="root"></div>
    
    <!-- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ï¼ˆPWAæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
    <div id="install-prompt" style="display: none; position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button id="install-button" class="bg-blue-600 text-white px-4 py-3 rounded-full shadow-lg hover:bg-blue-700 transition-all install-pulse">
            ğŸ“± ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        </button>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const StudyTool = () => {
            const [selectedSubject, setSelectedSubject] = useState(null);
            const [currentSection, setCurrentSection] = useState('menu');
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [isInstalled, setIsInstalled] = useState(false);
            
            // å­¦ç¿’é€²æ—ãƒ‡ãƒ¼ã‚¿ï¼ˆlocalStorageå®Œå…¨å¯¾å¿œï¼‰
            const [mathProgress, setMathProgress] = useState(() => {
                const saved = localStorage.getItem('caritas_mathProgress');
                return saved ? JSON.parse(saved) : { solved: 0, totalTime: 0, lastStudied: null };
            });
            
            const [englishProgress, setEnglishProgress] = useState(() => {
                const saved = localStorage.getItem('caritas_englishProgress');
                return saved ? JSON.parse(saved) : { words: 0, totalTime: 0, lastStudied: null };
            });

            // å­¦ç¿’å±¥æ­´
            const [mathHistory, setMathHistory] = useState(() => {
                const saved = localStorage.getItem('caritas_mathHistory');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [englishHistory, setEnglishHistory] = useState(() => {
                const saved = localStorage.getItem('caritas_englishHistory');
                return saved ? JSON.parse(saved) : [];
            });

            // è¨­å®šä¿å­˜
            const [savedSettings, setSavedSettings] = useState(() => {
                const saved = localStorage.getItem('caritas_savedSettings');
                return saved ? JSON.parse(saved) : {
                    math: { grade: 'ä¸­2', unit: 'å…¨åˆ†é‡', level: 'åŸºç¤' }
                };
            });

            // å­¦ç¿’æ™‚é–“è¿½è·¡
            const [sessionStartTime, setSessionStartTime] = useState(null);
            const [currentSessionTime, setCurrentSessionTime] = useState(0);

            // Claude APIæ¨¡æ“¬é–¢æ•°ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
            const mockClaudeComplete = async (prompt) => {
                // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯å³åº§ã«ã‚µãƒ³ãƒ—ãƒ«å•é¡Œã‚’è¿”ã™
                if (!isOnline) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                } else {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
                if (prompt.includes('æ•°å­¦å•é¡Œ')) {
                    const sampleProblems = [
                        {
                            grade: "ä¸­2", level: "åŸºç¤", unit: "å› æ•°åˆ†è§£",
                            problem: "xÂ² - 5x + 6 ã‚’å› æ•°åˆ†è§£ã—ãªã•ã„ã€‚",
                            answer: "(x - 2)(x - 3)"
                        },
                        {
                            grade: "ä¸­2", level: "æ¨™æº–", unit: "é€£ç«‹æ–¹ç¨‹å¼",
                            problem: "é€£ç«‹æ–¹ç¨‹å¼ x + y = 5, 2x - y = 1 ã‚’è§£ããªã•ã„ã€‚",
                            answer: "x = 2, y = 3"
                        },
                        {
                            grade: "ä¸­3", level: "å¿œç”¨", unit: "äºŒæ¬¡é–¢æ•°",
                            problem: "y = xÂ² - 4x + 3 ã®æœ€å°å€¤ã¨ãã®ã¨ãã®xã®å€¤ã‚’æ±‚ã‚ãªã•ã„ã€‚",
                            answer: "x = 2 ã®ã¨ãæœ€å°å€¤ -1"
                        }
                    ];
                    
                    const randomProblem = sampleProblems[Math.floor(Math.random() * sampleProblems.length)];
                    
                    return JSON.stringify({
                        ...randomProblem,
                        steps: [
                            {
                                step: "å•é¡Œç†è§£",
                                content: "ã“ã®å•é¡Œã®è¦æ±‚ã‚’ç¢ºèªã—ã¾ã™ã€‚",
                                explanation: "ä½•ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã‹ã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚"
                            },
                            {
                                step: "è§£æ³•é¸æŠ",
                                content: "æœ€é©ãªè§£æ³•ã‚’é¸æŠã—ã¾ã™ã€‚",
                                explanation: "åŠ¹ç‡çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’è€ƒãˆã¾ã™ã€‚"
                            },
                            {
                                step: "è¨ˆç®—éç¨‹",
                                content: "æ®µéšçš„ã«è¨ˆç®—ã‚’é€²ã‚ã¾ã™ã€‚",
                                explanation: "ä¸€æ­©ãšã¤ä¸å¯§ã«è§£ã„ã¦ã„ãã¾ã™ã€‚"
                            },
                            {
                                step: "æ€è€ƒã®æµã‚Œ",
                                content: "è«–ç†çš„ãªæµã‚Œã‚’ç¢ºèªã—ã¾ã™ã€‚",
                                explanation: "ãªãœãã†è€ƒãˆã‚‹ã®ã‹ã‚’ç†è§£ã—ã¾ã™ã€‚"
                            },
                            {
                                step: "æ¤œç®—ãƒ»ç¢ºèª",
                                content: "ç­”ãˆãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¾ã™ã€‚",
                                explanation: "è¨ˆç®—ãƒŸã‚¹ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚"
                            },
                            {
                                step: "é¡ä¼¼å•é¡Œã¸ã®å¿œç”¨",
                                content: "ã“ã®è§£æ³•ã®å¿œç”¨ã‚’è€ƒãˆã¾ã™ã€‚",
                                explanation: "åŒã˜è€ƒãˆæ–¹ãŒä½¿ãˆã‚‹å ´é¢ã‚’ç†è§£ã—ã¾ã™ã€‚"
                            }
                        ]
                    });
                } else {
                    const sampleWords = [
                        {
                            word: "environment", meaning: "ç’°å¢ƒ", level: "core",
                            pronunciation: "/ÉªnËˆvaÉªrÉ™nmÉ™nt/",
                            examples: [
                                { english: "We must protect the environment.", japanese: "ç§ãŸã¡ã¯ç’°å¢ƒã‚’ä¿è­·ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚" },
                                { english: "The school environment is very friendly.", japanese: "å­¦æ ¡ã®ç’°å¢ƒã¯ã¨ã¦ã‚‚ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ã™ã€‚" },
                                { english: "Climate change affects the global environment.", japanese: "æ°—å€™å¤‰å‹•ã¯åœ°çƒç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚" }
                            ],
                            usage_tip: "ã€Œç’°å¢ƒã€ã¨ã„ã†æ„å‘³ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹é‡è¦ãªåè©ã§ã™ã€‚"
                        },
                        {
                            word: "communicate", meaning: "ä¼ãˆã‚‹ã€äº¤æµã™ã‚‹", level: "core",
                            pronunciation: "/kÉ™ËˆmjuËnÉªkeÉªt/",
                            examples: [
                                { english: "We communicate through email.", japanese: "ç§ãŸã¡ã¯ãƒ¡ãƒ¼ãƒ«ã§ã‚„ã‚Šå–ã‚Šã—ã¾ã™ã€‚" },
                                { english: "It's important to communicate clearly.", japanese: "æ˜ç¢ºã«ä¼ãˆã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚" },
                                { english: "Animals communicate in different ways.", japanese: "å‹•ç‰©ã¯æ§˜ã€…ãªæ–¹æ³•ã§ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šã¾ã™ã€‚" }
                            ],
                            usage_tip: "å‹•è©ã¨ã—ã¦ã€Œä¼ãˆã‚‹ã€ã€åè©å½¢ã¯communicationã§ã™ã€‚"
                        },
                        {
                            word: "technology", meaning: "æŠ€è¡“ã€ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼", level: "expansion",
                            pronunciation: "/tekËˆnÉ’lÉ™dÊ’i/",
                            examples: [
                                { english: "Technology changes our daily life.", japanese: "æŠ€è¡“ã¯ç§ãŸã¡ã®æ—¥å¸¸ç”Ÿæ´»ã‚’å¤‰ãˆã¾ã™ã€‚" },
                                { english: "New technology helps solve problems.", japanese: "æ–°ã—ã„æŠ€è¡“ã¯å•é¡Œè§£æ±ºã«å½¹ç«‹ã¡ã¾ã™ã€‚" },
                                { english: "We study computer technology at school.", japanese: "å­¦æ ¡ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿æŠ€è¡“ã‚’å­¦ã‚“ã§ã„ã¾ã™ã€‚" }
                            ],
                            usage_tip: "å¯ç®—åè©ã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚"
                        }
                    ];
                    
                    const randomWord = sampleWords[Math.floor(Math.random() * sampleWords.length)];
                    return JSON.stringify(randomWord);
                }
            };

            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®ç›£è¦–
            useEffect(() => {
                const handleOnline = () => {
                    setIsOnline(true);
                    document.getElementById('offline-banner').style.display = 'none';
                };
                
                const handleOffline = () => {
                    setIsOnline(false);
                    document.getElementById('offline-banner').style.display = 'block';
                };

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                // åˆæœŸçŠ¶æ…‹ã®è¨­å®š
                if (!navigator.onLine) {
                    document.getElementById('offline-banner').style.display = 'block';
                }

                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ…‹ã®ç¢ºèª
            useEffect(() => {
                // æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    setIsInstalled(true);
                } else {
                    document.getElementById('install-prompt').style.display = 'block';
                }
            }, []);

            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜é–¢æ•°ï¼ˆPWAå¯¾å¿œï¼‰
            const saveData = () => {
                try {
                    localStorage.setItem('caritas_mathProgress', JSON.stringify(mathProgress));
                    localStorage.setItem('caritas_englishProgress', JSON.stringify(englishProgress));
                    localStorage.setItem('caritas_mathHistory', JSON.stringify(mathHistory));
                    localStorage.setItem('caritas_englishHistory', JSON.stringify(englishHistory));
                    localStorage.setItem('caritas_savedSettings', JSON.stringify(savedSettings));
                } catch (error) {
                    console.warn('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                }
            };

            // å­¦ç¿’æ™‚é–“æ›´æ–°
            useEffect(() => {
                if (sessionStartTime) {
                    const interval = setInterval(() => {
                        setCurrentSessionTime(Math.floor((Date.now() - sessionStartTime) / 60000));
                    }, 60000);
                    return () => clearInterval(interval);
                }
            }, [sessionStartTime]);

            // ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜
            useEffect(() => {
                saveData();
            }, [mathProgress, englishProgress, mathHistory, englishHistory, savedSettings]);

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
            const startSession = (subject) => {
                setSessionStartTime(Date.now());
                setSelectedSubject(subject);
                setCurrentSection('study');
            };

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®é€²æ—ä¿å­˜
            const endSession = () => {
                if (sessionStartTime && currentSessionTime > 0) {
                    if (selectedSubject === 'math') {
                        setMathProgress(prev => ({
                            ...prev,
                            totalTime: prev.totalTime + currentSessionTime,
                            lastStudied: new Date().toISOString()
                        }));
                    } else if (selectedSubject === 'english') {
                        setEnglishProgress(prev => ({
                            ...prev,
                            totalTime: prev.totalTime + currentSessionTime,
                            lastStudied: new Date().toISOString()
                        }));
                    }
                }
                setSessionStartTime(null);
                setCurrentSessionTime(0);
            };

            // å•é¡Œç”Ÿæˆï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
            const generateProblem = async () => {
                try {
                    const response = await mockClaudeComplete('æ•°å­¦å•é¡Œã‚’ç”Ÿæˆ');
                    const problem = JSON.parse(response);
                    
                    setMathProgress(prev => ({
                        ...prev,
                        solved: prev.solved + 1,
                        lastStudied: new Date().toISOString()
                    }));
                    
                    const historyItem = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        ...problem,
                        completed: true
                    };
                    setMathHistory(prev => [historyItem, ...prev.slice(0, 49)]);
                    
                    return problem;
                } catch (error) {
                    console.error('å•é¡Œç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    return null;
                }
            };

            // å˜èªç”Ÿæˆï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
            const generateWord = async () => {
                try {
                    const response = await mockClaudeComplete('è‹±å˜èªã‚’ç”Ÿæˆ');
                    const word = JSON.parse(response);
                    
                    setEnglishProgress(prev => ({
                        ...prev,
                        words: prev.words + 1,
                        lastStudied: new Date().toISOString()
                    }));
                    
                    const historyItem = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        ...word,
                        studied: true
                    };
                    setEnglishHistory(prev => [historyItem, ...prev.slice(0, 99)]);
                    
                    return word;
                } catch (error) {
                    console.error('å˜èªç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    return null;
                }
            };

            if (currentSection === 'menu') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4 no-select">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ“š</div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                    ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡
                                </h1>
                                <h2 className="text-xl font-semibold text-gray-700 mb-2">
                                    AIè©¦é¨“å¯¾ç­–ãƒ„ãƒ¼ãƒ«
                                </h2>
                                <p className="text-gray-600">ä¸­2ã€œä¸­3 å¯¾å¿œï¼ˆä½“ç³»æ•°å­¦ãƒ»Progress 21æº–æ‹ ï¼‰</p>
                                <div className="mt-4 flex flex-wrap justify-center gap-2 text-sm">
                                    <span className="bg-purple-100 text-purple-800 px-3 py-1 rounded-full">
                                        ğŸ“± PWAã‚¢ãƒ—ãƒª
                                    </span>
                                    <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full">
                                        ğŸ’¾ è‡ªå‹•ä¿å­˜
                                    </span>
                                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
                                        ğŸ“¶ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
                                    </span>
                                </div>
                            </div>

                            <div className="grid md:grid-cols-2 gap-6 mb-8">
                                <div 
                                    onClick={() => startSession('math')}
                                    className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-all cursor-pointer border-l-4 border-blue-500 active:scale-95"
                                >
                                    <div className="flex items-center gap-4 mb-4">
                                        <div className="bg-blue-100 p-3 rounded-lg text-3xl">ğŸ§®</div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">æ•°å­¦</h2>
                                            <p className="text-gray-600">ä½“ç³»æ•°å­¦æº–æ‹ </p>
                                        </div>
                                    </div>
                                    <ul className="text-sm text-gray-700 space-y-1">
                                        <li>â€¢ ğŸ¤– AIå•é¡Œç”Ÿæˆï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰</li>
                                        <li>â€¢ ğŸ“ 6æ®µéšã‚¹ãƒ†ãƒƒãƒ—è§£èª¬</li>
                                        <li>â€¢ âš–ï¸ 4æ®µéšé›£æ˜“åº¦é¸æŠ</li>
                                        <li>â€¢ ğŸ’¾ å­¦ç¿’é€²æ—è‡ªå‹•ä¿å­˜</li>
                                    </ul>
                                    <div className="mt-4 space-y-1 text-sm">
                                        <div className="text-blue-600 font-semibold">
                                            è§£ç­”æ¸ˆã¿: {mathProgress.solved} å•é¡Œ
                                        </div>
                                        <div className="text-gray-500">
                                            å­¦ç¿’æ™‚é–“: {mathProgress.totalTime}åˆ†
                                        </div>
                                        {mathProgress.lastStudied && (
                                            <div className="text-gray-400 text-xs">
                                                æœ€çµ‚å­¦ç¿’: {new Date(mathProgress.lastStudied).toLocaleDateString()}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div 
                                    onClick={() => startSession('english')}
                                    className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-all cursor-pointer border-l-4 border-green-500 active:scale-95"
                                >
                                    <div className="flex items-center gap-4 mb-4">
                                        <div className="bg-green-100 p-3 rounded-lg text-3xl">ğŸ“–</div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">è‹±èª</h2>
                                            <p className="text-gray-600">Progress 21æº–æ‹ </p>
                                        </div>
                                    </div>
                                    <ul className="text-sm text-gray-700 space-y-1">
                                        <li>â€¢ ğŸ¤– AIå˜èªé¸å‡ºï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰</li>
                                        <li>â€¢ ğŸ‘ï¸ æ—¥æœ¬èªè¨³è¡¨ç¤ºåˆ‡æ›¿</li>
                                        <li>â€¢ ğŸ”„ å¿˜å´æ›²ç·šå¯¾å¿œ</li>
                                        <li>â€¢ ğŸ’¾ å­¦ç¿’é€²æ—è‡ªå‹•ä¿å­˜</li>
                                    </ul>
                                    <div className="mt-4 space-y-1 text-sm">
                                        <div className="text-green-600 font-semibold">
                                            å­¦ç¿’æ¸ˆã¿: {englishProgress.words} èª
                                        </div>
                                        <div className="text-gray-500">
                                            å­¦ç¿’æ™‚é–“: {englishProgress.totalTime}åˆ†
                                        </div>
                                        {englishProgress.lastStudied && (
                                            <div className="text-gray-400 text-xs">
                                                æœ€çµ‚å­¦ç¿’: {new Date(englishProgress.lastStudied).toLocaleDateString()}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-6 rounded-lg shadow-lg">
                                <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">
                                    ğŸ“± PWAã‚¢ãƒ—ãƒªã®ç‰¹å¾´
                                </h3>
                                <div className="grid md:grid-cols-3 gap-4 text-sm">
                                    <div className="bg-blue-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ“±</div>
                                        <h4 className="font-bold text-blue-900 mb-1">ã‚¢ãƒ—ãƒªåŒ–</h4>
                                        <p className="text-blue-700">ã‚¹ãƒãƒ›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½</p>
                                    </div>
                                    <div className="bg-green-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ“¶</div>
                                        <h4 className="font-bold text-green-900 mb-1">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</h4>
                                        <p className="text-green-700">ãƒãƒƒãƒˆç„¡ã—ã§ã‚‚å‹•ä½œ</p>
                                    </div>
                                    <div className="bg-purple-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ’¾</div>
                                        <h4 className="font-bold text-purple-900 mb-1">ãƒ‡ãƒ¼ã‚¿ä¿æŒ</h4>
                                        <p className="text-purple-700">é€²æ—å®Œå…¨ä¿å­˜</p>
                                    </div>
                                </div>
                                
                                <div className="mt-6 text-center">
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h4 className="font-bold text-gray-800 mb-2">ğŸ“Š å­¦ç¿’çµ±è¨ˆ</h4>
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span className="text-gray-600">åˆè¨ˆå­¦ç¿’æ™‚é–“</span>
                                                <div className="text-lg font-bold text-blue-600">
                                                    {mathProgress.totalTime + englishProgress.totalTime}åˆ†
                                                </div>
                                            </div>
                                            <div>
                                                <span className="text-gray-600">ä¿å­˜æ¸ˆã¿å±¥æ­´</span>
                                                <div className="text-lg font-bold text-green-600">
                                                    {mathHistory.length + englishHistory.length}ä»¶
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // å­¦ç¿’ç”»é¢ï¼ˆç°¡ç•¥ç‰ˆ - PWAå¯¾å¿œï¼‰
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex items-center gap-4 mb-6">
                            <button
                                onClick={() => {
                                    endSession();
                                    setCurrentSection('menu');
                                }}
                                className="bg-white p-3 rounded-lg shadow hover:shadow-md transition-all text-xl active:scale-95"
                            >
                                â†©ï¸
                            </button>
                            <h1 className="text-2xl font-bold text-gray-800">
                                {selectedSubject === 'math' ? 'ğŸ§® æ•°å­¦å­¦ç¿’' : 'ğŸ“– è‹±èªå­¦ç¿’'}
                            </h1>
                            {currentSessionTime > 0 && (
                                <div className="text-sm text-green-600 bg-green-100 px-3 py-1 rounded-full">
                                    â±ï¸ {currentSessionTime}åˆ†
                                </div>
                            )}
                        </div>
                        
                        <div className="bg-white p-8 rounded-lg shadow-lg text-center">
                            <div className="text-6xl mb-4">
                                {selectedSubject === 'math' ? 'ğŸ§®' : 'ğŸ“–'}
                            </div>
                            <h3 className="text-xl font-bold text-gray-800 mb-4">
                                {selectedSubject === 'math' ? 'æ•°å­¦' : 'è‹±èª'}å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰
                            </h3>
                            <p className="text-gray-600 mb-6">
                                {isOnline ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}ã§å­¦ç¿’ä¸­
                            </p>
                            
                            <div className="space-y-4">
                                <button
                                    onClick={async () => {
                                        if (selectedSubject === 'math') {
                                            const problem = await generateProblem();
                                            if (problem) {
                                                alert(`âœ… æ•°å­¦å•é¡Œã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼\nå•é¡Œ: ${problem.problem}\nè§£ç­”: ${problem.answer}`);
                                            }
                                        } else {
                                            const word = await generateWord();
                                            if (word) {
                                                alert(`âœ… è‹±å˜èªã‚’å­¦ç¿’ã—ã¾ã—ãŸï¼\nå˜èª: ${word.word}\næ„å‘³: ${word.meaning}`);
                                            }
                                        }
                                    }}
                                    className="bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition-colors text-lg font-medium w-full md:w-auto"
                                >
                                    {selectedSubject === 'math' ? 'ğŸ² å•é¡Œã‚’ç”Ÿæˆ' : 'ğŸ“ å˜èªã‚’å­¦ç¿’'}
                                </button>
                                
                                <div className="text-sm text-gray-500">
                                    {selectedSubject === 'math' ? 
                                        `ä»Šã¾ã§ã« ${mathProgress.solved} å•é¡Œã‚’è§£ãã¾ã—ãŸ` :
                                        `ä»Šã¾ã§ã« ${englishProgress.words} èªã‚’å­¦ç¿’ã—ã¾ã—ãŸ`
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<StudyTool />, document.getElementById('root'));
    </script>

    <script>
        // Service Workerç™»éŒ²ï¼ˆPWAæ©Ÿèƒ½ï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                const swCode = `
                    const CACHE_NAME = 'caritas-study-v1.0.0';
                    const urlsToCache = [
                        '/',
                        '/index.html',
                        'https://cdn.tailwindcss.com/3.3.2',
                        'https://unpkg.com/react@18/umd/react.development.js',
                        'https://unpkg.com/react-dom@18/umd/react-dom.development.js',
                        'https://unpkg.com/@babel/standalone/babel.min.js'
                    ];

                    self.addEventListener('install', function(event) {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(function(cache) {
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', function(event) {
                        event.respondWith(
                            caches.match(event.request)
                                .then(function(response) {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function(registration) {
                        console.log('ServiceWorkerç™»éŒ²æˆåŠŸ:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorkerç™»éŒ²å¤±æ•—:', error);
                    });
            });
        }

        // PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').style.display = 'block';
        });

        document.getElementById('install-button').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('install-prompt').style.display = 'none';
                }
                deferredPrompt = null;
            }
        });

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’éè¡¨ç¤º
        window.addEventListener('appinstalled', () => {
            document.getElementById('install-prompt').style.display = 'none';
        });
    </script>
</body>
</html>