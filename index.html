<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ AIè©¦é¨“å¯¾ç­–ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- PWAç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
    <meta name="description" content="ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ã®ä½“ç³»æ•°å­¦ãƒ»Progress 21æº–æ‹ ã®AIå­¦ç¿’ãƒ„ãƒ¼ãƒ«">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã‚«ãƒªã‚¿ã‚¹AIå­¦ç¿’">
    
    <!-- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .loading-dots:after {
            content: '...';
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
        
        .step-animation {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const StudyTool = () => {
            const [selectedSubject, setSelectedSubject] = useState(null);
            const [currentSection, setCurrentSection] = useState('menu');
            const [isLoading, setIsLoading] = useState(false);
            const [apiStatus, setApiStatus] = useState({ connected: false, checking: true });
            
            // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿
            const [mathProgress, setMathProgress] = useState(() => {
                const saved = localStorage.getItem('caritas_mathProgress');
                return saved ? JSON.parse(saved) : { solved: 0, totalTime: 0 };
            });
            
            const [englishProgress, setEnglishProgress] = useState(() => {
                const saved = localStorage.getItem('caritas_englishProgress');
                return saved ? JSON.parse(saved) : { words: 0, totalTime: 0 };
            });

            const [currentProblem, setCurrentProblem] = useState(null);
            const [currentWord, setCurrentWord] = useState(null);

            // APIæ¥ç¶šç¢ºèª
            useEffect(() => {
                const checkApiStatus = async () => {
                    try {
                        const response = await fetch('/api/health');
                        const data = await response.json();
                        setApiStatus({
                            connected: data.ai_available,
                            checking: false,
                            version: data.version,
                            environment: data.environment
                        });
                    } catch (error) {
                        console.error('APIæ¥ç¶šç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                        setApiStatus({ connected: false, checking: false });
                    }
                };
                checkApiStatus();
            }, []);

            // ãƒ‡ãƒ¼ã‚¿è‡ªå‹•ä¿å­˜
            useEffect(() => {
                localStorage.setItem('caritas_mathProgress', JSON.stringify(mathProgress));
                localStorage.setItem('caritas_englishProgress', JSON.stringify(englishProgress));
            }, [mathProgress, englishProgress]);

            // AIå•é¡Œç”Ÿæˆé–¢æ•°
            const generateMathProblem = async (grade, unit, level) => {
                setIsLoading(true);

                const prompt = `
ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ã®ä½“ç³»æ•°å­¦ã«æº–æ‹ ã—ãŸæ•°å­¦å•é¡Œã‚’1å•ä½œæˆã—ã¦ãã ã•ã„ã€‚

è¨­å®š:
- å­¦å¹´: ${grade}
- åˆ†é‡: ${unit === 'å…¨åˆ†é‡' ? 'è©²å½“å­¦å¹´ã®å…¨åˆ†é‡ã‹ã‚‰é¸æŠ' : unit}
- é›£æ˜“åº¦: ${level}

ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã—ã¦ãã ã•ã„:
1. ${grade}ãƒ¬ãƒ™ãƒ«ã«é©ã—ãŸå•é¡Œ
2. æ€è€ƒåŠ›ã‚’è¦ã™ã‚‹è‰¯è³ªãªå•é¡Œ
3. ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ã®é«˜åº¦ãªã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã«å¯¾å¿œ

å›ç­”ã¯ä»¥ä¸‹ã®JSONå½¢å¼ã§ãŠé¡˜ã„ã—ã¾ã™:
{
  "grade": "${grade}",
  "level": "${level}",
  "unit": "å®Ÿéš›ã«é¸æŠã—ãŸå…·ä½“çš„ãªå˜å…ƒå",
  "problem": "å•é¡Œæ–‡ï¼ˆæ•°å¼å«ã‚€ï¼‰",
  "steps": [
    {
      "step": "å•é¡Œç†è§£",
      "content": "å•é¡Œã®è¦æ±‚ã¨ä¸ãˆã‚‰ã‚ŒãŸæ¡ä»¶ã‚’æ•´ç†",
      "explanation": "ä½•ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã‹ã€ã©ã‚“ãªæ¡ä»¶ãŒã‚ã‚‹ã‹ã‚’æ˜ç¢ºåŒ–",
      "detail": "ã‚ˆã‚Šè©³ã—ã„è§£èª¬ã‚„æ³¨æ„ç‚¹"
    },
    {
      "step": "è§£æ³•é¸æŠ",
      "content": "ã“ã®å•é¡Œã«æœ€é©ãªè§£æ³•ã‚’é¸æŠ",
      "explanation": "ãªãœãã®è§£æ³•ã‚’é¸ã¶ã®ã‹ã®ç†ç”±",
      "detail": "ä»–ã®è§£æ³•ã¨ã®æ¯”è¼ƒã‚„ã€é¸æŠç†ç”±ã®è©³ç´°"
    },
    {
      "step": "è¨ˆç®—éç¨‹",
      "content": "å…·ä½“çš„ãªè¨ˆç®—æ‰‹é †",
      "explanation": "å„è¨ˆç®—ã®æ„å‘³ã¨ç›®çš„",
      "detail": "è¨ˆç®—ã®å·¥å¤«ã‚„æ³¨æ„ã™ã¹ãç‚¹"
    },
    {
      "step": "æ€è€ƒã®æµã‚Œ",
      "content": "è«–ç†çš„ãªæ€è€ƒãƒ—ãƒ­ã‚»ã‚¹",
      "explanation": "ã©ã®ã‚ˆã†ãªæ€è€ƒã§è§£ç­”ã«åˆ°é”ã™ã‚‹ã‹",
      "detail": "ã¤ã¾ãšãã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã¨ãã®å¯¾ç­–"
    },
    {
      "step": "æ¤œç®—ãƒ»ç¢ºèª",
      "content": "ç­”ãˆã®æ­£ã—ã•ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•",
      "explanation": "ãªãœæ¤œç®—ãŒé‡è¦ã‹ã®èª¬æ˜",
      "detail": "å…·ä½“çš„ãªæ¤œç®—æ‰‹é †ã¨ç¢ºèªãƒã‚¤ãƒ³ãƒˆ"
    },
    {
      "step": "é¡ä¼¼å•é¡Œã¸ã®å¿œç”¨",
      "content": "ã“ã®è§£æ³•ãŒä½¿ãˆã‚‹ä»–ã®å•é¡Œä¾‹",
      "explanation": "å­¦ç¿’ã—ãŸå†…å®¹ã®å¿œç”¨ç¯„å›²",
      "detail": "ç™ºå±•çš„ãªå•é¡Œã‚„å®Ÿéš›ã®å…¥è©¦ã§ã®å‡ºé¡Œä¾‹"
    }
  ],
  "answer": "æœ€çµ‚çš„ãªç­”æ¡ˆ",
  "hint": "å›°ã£ãŸã¨ãã®ãƒ’ãƒ³ãƒˆ",
  "difficulty_analysis": "ã“ã®å•é¡Œã®é›£ã—ã•ã®åˆ†æ",
  "learning_point": "ã“ã®å•é¡Œã§èº«ã«ã¤ãå­¦ç¿’å†…å®¹"
}

DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.
                `;

                try {
                    const response = await fetch('/api/generate-math', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt })
                    });

                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.error || 'API ã‚¨ãƒ©ãƒ¼');
                    }

                    const problemData = JSON.parse(data.result);
                    setCurrentProblem(problemData);
                    
                    // é€²æ—æ›´æ–°
                    setMathProgress(prev => ({
                        ...prev,
                        solved: prev.solved + 1
                    }));

                    return problemData;

                } catch (error) {
                    console.error('AIå•é¡Œç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    alert(`å•é¡Œç”Ÿæˆã‚¨ãƒ©ãƒ¼: ${error.message}\n\nã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚`);
                    return null;
                } finally {
                    setIsLoading(false);
                }
            };

            // æ•°å­¦å­¦ç¿’ã‚»ã‚¯ã‚·ãƒ§ãƒ³
            const MathSection = () => {
                const [selectedGrade, setSelectedGrade] = useState('ä¸­2');
                const [selectedUnit, setSelectedUnit] = useState('å…¨åˆ†é‡');
                const [selectedLevel, setSelectedLevel] = useState('åŸºç¤');
                const [showSteps, setShowSteps] = useState(false);
                const [currentStep, setCurrentStep] = useState(0);

                const gradeOptions = ['ä¸­1', 'ä¸­2', 'ä¸­3', 'é«˜1'];
                const unitsByGrade = {
                    'ä¸­1': ['å…¨åˆ†é‡', 'æ­£è² ã®æ•°', 'æ–‡å­—å¼', 'ä¸€æ¬¡æ–¹ç¨‹å¼', 'æ¯”ä¾‹ãƒ»åæ¯”ä¾‹'],
                    'ä¸­2': ['å…¨åˆ†é‡', 'å¼ã®è¨ˆç®—', 'é€£ç«‹æ–¹ç¨‹å¼', 'ä¸€æ¬¡é–¢æ•°', 'å›³å½¢ã®æ€§è³ª'],
                    'ä¸­3': ['å…¨åˆ†é‡', 'å¼ã®å±•é–‹ãƒ»å› æ•°åˆ†è§£', 'å¹³æ–¹æ ¹', 'äºŒæ¬¡æ–¹ç¨‹å¼', 'äºŒæ¬¡é–¢æ•°'],
                    'é«˜1': ['å…¨åˆ†é‡', 'æ•°ã¨å¼', 'é›†åˆã¨å‘½é¡Œ', 'äºŒæ¬¡é–¢æ•°', 'å›³å½¢ã¨è¨ˆé‡']
                };
                const levelOptions = [
                    { value: 'åŸºç¤', description: 'åŸºæœ¬çš„ãªè¨ˆç®—ãƒ»å…¬å¼ã®ç¢ºèª' },
                    { value: 'æ¨™æº–', description: 'å®šæœŸãƒ†ã‚¹ãƒˆãƒ»æ•™ç§‘æ›¸ãƒ¬ãƒ™ãƒ«' },
                    { value: 'å¿œç”¨', description: 'æ€è€ƒåŠ›ãƒ»è¤‡åˆå•é¡Œ' },
                    { value: 'ç™ºå±•', description: 'å…¥è©¦ãƒ¬ãƒ™ãƒ«ãƒ»é«˜åº¦ãªå•é¡Œ' }
                ];

                if (isLoading) {
                    return (
                        <div className="flex items-center justify-center h-64">
                            <div className="text-center">
                                <div className="text-4xl mb-4 pulse-animation">ğŸ¤–</div>
                                <div className="text-xl font-bold text-blue-600 mb-2">
                                    AIãŒé«˜å“è³ªãªå•é¡Œã‚’ç”Ÿæˆä¸­<span className="loading-dots"></span>
                                </div>
                                <div className="text-sm text-gray-600 mb-4">
                                    ä½“ç³»æ•°å­¦ã«æº–æ‹ ã—ãŸæ€è€ƒåŠ›å•é¡Œã‚’ä½œæˆã—ã¦ã„ã¾ã™
                                </div>
                                <div className="w-64 bg-gray-200 rounded-full h-2 mx-auto">
                                    <div className="bg-blue-600 h-2 rounded-full animate-pulse" style={{width: '75%'}}></div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (!currentProblem) {
                    return (
                        <div className="space-y-6">
                            {/* AIè¨­å®šãƒ‘ãƒãƒ« */}
                            <div className="bg-white p-6 rounded-lg shadow border">
                                <h4 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    ğŸ¤– AIå•é¡Œç”Ÿæˆè¨­å®š
                                </h4>
                                <div className="grid md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">å­¦å¹´</label>
                                        <select
                                            value={selectedGrade}
                                            onChange={(e) => setSelectedGrade(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                        >
                                            {gradeOptions.map(grade => (
                                                <option key={grade} value={grade}>{grade}</option>
                                            ))}
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">åˆ†é‡</label>
                                        <select
                                            value={selectedUnit}
                                            onChange={(e) => setSelectedUnit(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                        >
                                            {unitsByGrade[selectedGrade].map(unit => (
                                                <option key={unit} value={unit}>{unit}</option>
                                            ))}
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">é›£æ˜“åº¦</label>
                                        <select
                                            value={selectedLevel}
                                            onChange={(e) => setSelectedLevel(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                        >
                                            {levelOptions.map(level => (
                                                <option key={level.value} value={level.value}>
                                                    {level.value} - {level.description}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                                
                                <div className="flex items-center gap-2 mb-4">
                                    <div className={`w-3 h-3 rounded-full ${apiStatus.connected ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                    <span className="text-sm text-gray-600">
                                        AIçŠ¶æ…‹: {apiStatus.checking ? 'ãƒã‚§ãƒƒã‚¯ä¸­...' : (apiStatus.connected ? 'æ¥ç¶šæ¸ˆã¿' : 'æ¥ç¶šã‚¨ãƒ©ãƒ¼')}
                                    </span>
                                </div>
                            </div>

                            <div className="text-center bg-gradient-to-r from-blue-50 to-purple-50 p-8 rounded-lg">
                                <div className="text-6xl mb-4">ğŸ¤–</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">
                                    AIå•é¡Œç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
                                </h3>
                                <p className="text-gray-600 mb-6">
                                    è¨­å®š: {selectedGrade} | {selectedUnit} | {selectedLevel}ãƒ¬ãƒ™ãƒ«
                                </p>
                                <button
                                    onClick={() => generateMathProblem(selectedGrade, selectedUnit, selectedLevel)}
                                    disabled={!apiStatus.connected}
                                    className={`px-8 py-4 rounded-lg text-lg font-medium transition-all transform hover:scale-105 ${
                                        apiStatus.connected 
                                            ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                            : 'bg-gray-400 text-gray-600 cursor-not-allowed'
                                    }`}
                                >
                                    {apiStatus.connected ? 'ğŸš€ AIå•é¡Œç”Ÿæˆé–‹å§‹' : 'âŒ AIæ¥ç¶šãŒå¿…è¦ã§ã™'}
                                </button>
                                <p className="text-sm text-gray-500 mt-4">
                                    {apiStatus.connected 
                                        ? 'ç´„3-5ç§’ã§é«˜å“è³ªãªå•é¡Œã¨è©³ç´°è§£èª¬ã‚’ç”Ÿæˆã—ã¾ã™'
                                        : 'ã‚µãƒ¼ãƒãƒ¼ã®APIã‚­ãƒ¼è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„'
                                    }
                                </p>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="space-y-6">
                        {/* å•é¡Œè¡¨ç¤º */}
                        <div className="bg-blue-50 p-6 rounded-lg">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-xl font-bold text-blue-900">
                                    ğŸ¤– AIç”Ÿæˆå•é¡Œ - {currentProblem.grade} {currentProblem.unit}
                                </h3>
                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                    currentProblem.level === 'åŸºç¤' ? 'bg-green-200 text-green-800' :
                                    currentProblem.level === 'æ¨™æº–' ? 'bg-blue-200 text-blue-800' :
                                    currentProblem.level === 'å¿œç”¨' ? 'bg-orange-200 text-orange-800' :
                                    'bg-red-200 text-red-800'
                                }`}>
                                    {currentProblem.level}ãƒ¬ãƒ™ãƒ«
                                </span>
                            </div>
                            
                            <div className="bg-white p-6 rounded border-l-4 border-blue-500">
                                <p className="text-lg font-medium mb-4">{currentProblem.problem}</p>
                                {currentProblem.hint && (
                                    <div className="bg-yellow-50 p-3 rounded border-l-4 border-yellow-400">
                                        <p className="text-sm text-yellow-800">
                                            ğŸ’¡ <strong>ãƒ’ãƒ³ãƒˆ:</strong> {currentProblem.hint}
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {!showSteps ? (
                            <div className="flex gap-4">
                                <button
                                    onClick={() => setShowSteps(true)}
                                    className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                                >
                                    ğŸ§  AIè©³ç´°è§£èª¬ã‚’è¦‹ã‚‹
                                </button>
                                <button
                                    onClick={() => generateMathProblem(selectedGrade, selectedUnit, selectedLevel)}
                                    className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700"
                                >
                                    ğŸ”„ æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆ
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {/* 6æ®µéšã‚¹ãƒ†ãƒƒãƒ—è§£èª¬ */}
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h4 className="font-bold text-lg mb-4">ğŸ¤– AIç”Ÿæˆï¼š6æ®µéšè©³ç´°è§£èª¬</h4>
                                    
                                    <div className="flex gap-2 mb-6 flex-wrap">
                                        {currentProblem.steps.map((_, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => setCurrentStep(idx)}
                                                className={`px-4 py-2 rounded text-sm font-medium transition-all ${
                                                    currentStep === idx 
                                                        ? 'bg-blue-600 text-white shadow-md' 
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {idx + 1}. {currentProblem.steps[idx].step}
                                            </button>
                                        ))}
                                    </div>
                                    
                                    <div className="bg-white p-6 rounded border step-animation">
                                        <h5 className="font-bold text-blue-900 mb-3 text-lg">
                                            {currentStep + 1}. {currentProblem.steps[currentStep].step}
                                        </h5>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <h6 className="font-semibold text-gray-800 mb-2">ğŸ“ å†…å®¹</h6>
                                                <p className="text-gray-800 bg-gray-50 p-3 rounded">
                                                    {currentProblem.steps[currentStep].content}
                                                </p>
                                            </div>
                                            
                                            <div>
                                                <h6 className="font-semibold text-gray-800 mb-2">ğŸ’¡ è§£èª¬</h6>
                                                <p className="text-yellow-800 bg-yellow-50 p-3 rounded">
                                                    {currentProblem.steps[currentStep].explanation}
                                                </p>
                                            </div>
                                            
                                            {currentProblem.steps[currentStep].detail && (
                                                <div>
                                                    <h6 className="font-semibold text-gray-800 mb-2">ğŸ” è©³ç´°</h6>
                                                    <p className="text-blue-800 bg-blue-50 p-3 rounded">
                                                        {currentProblem.steps[currentStep].detail}
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="flex gap-2 mt-6">
                                        <button
                                            onClick={() => setCurrentStep(Math.max(0, currentStep - 1))}
                                            disabled={currentStep === 0}
                                            className="px-4 py-2 bg-gray-500 text-white rounded disabled:opacity-50"
                                        >
                                            â¬…ï¸ å‰ã®ã‚¹ãƒ†ãƒƒãƒ—
                                        </button>
                                        <button
                                            onClick={() => setCurrentStep(Math.min(currentProblem.steps.length - 1, currentStep + 1))}
                                            disabled={currentStep === currentProblem.steps.length - 1}
                                            className="px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50"
                                        >
                                            æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— â¡ï¸
                                        </button>
                                    </div>
                                </div>

                                {/* è§£ç­”ã¨åˆ†æ */}
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h4 className="font-bold text-green-900 mb-2">âœ… è§£ç­”</h4>
                                        <p className="text-green-800 text-lg font-medium">{currentProblem.answer}</p>
                                    </div>
                                    
                                    {currentProblem.learning_point && (
                                        <div className="bg-purple-50 p-4 rounded-lg">
                                            <h4 className="font-bold text-purple-900 mb-2">ğŸ“š å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ</h4>
                                            <p className="text-purple-800 text-sm">{currentProblem.learning_point}</p>
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-4">
                                    <button
                                        onClick={() => {
                                            setShowSteps(false);
                                            setCurrentStep(0);
                                        }}
                                        className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
                                    >
                                        ğŸ“‹ å•é¡Œã«æˆ»ã‚‹
                                    </button>
                                    <button
                                        onClick={() => generateMathProblem(selectedGrade, selectedUnit, selectedLevel)}
                                        className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
                                    >
                                        ğŸ”„ æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆ
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            if (currentSection === 'menu') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ¤–</div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                    ã‚«ãƒªã‚¿ã‚¹ä¸­å­¦æ ¡ AIå­¦ç¿’ãƒ„ãƒ¼ãƒ«
                                </h1>
                                <h2 className="text-xl font-semibold text-purple-700 mb-2">
                                    å®Œå…¨AIæ­è¼‰ç‰ˆ
                                </h2>
                                <p className="text-gray-600">ä½“ç³»æ•°å­¦ãƒ»Progress 21æº–æ‹  + æœ¬æ ¼AIå•é¡Œç”Ÿæˆ</p>
                                <div className="mt-4 flex flex-wrap justify-center gap-2 text-sm">
                                    <span className="bg-purple-100 text-purple-800 px-3 py-1 rounded-full">
                                        ğŸ¤– Claude AI
                                    </span>
                                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
                                        ğŸ“ è©³ç´°è§£èª¬
                                    </span>
                                    <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full">
                                        ğŸ¯ å®Œå…¨æº–æ‹ 
                                    </span>
                                </div>
                            </div>

                            {/* APIçŠ¶æ…‹è¡¨ç¤º */}
                            <div className="bg-white p-4 rounded-lg shadow mb-6">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <div className={`w-3 h-3 rounded-full ${apiStatus.connected ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                        <span className="text-sm font-medium">
                                            AIçŠ¶æ…‹: {apiStatus.checking ? 'ãƒã‚§ãƒƒã‚¯ä¸­...' : (apiStatus.connected ? 'æ¥ç¶šæ¸ˆã¿' : 'æ¥ç¶šã‚¨ãƒ©ãƒ¼')}
                                        </span>
                                    </div>
                                    {apiStatus.version && (
                                        <span className="text-xs text-gray-500">v{apiStatus.version}</span>
                                    )}
                                </div>
                            </div>

                            <div className="grid gap-6">
                                <div 
                                    onClick={() => {
                                        setSelectedSubject('math');
                                        setCurrentSection('study');
                                    }}
                                    className="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-all cursor-pointer border-l-4 border-blue-500"
                                >
                                    <div className="flex items-center gap-4 mb-4">
                                        <div className="bg-blue-100 p-3 rounded-lg text-3xl">ğŸ§®</div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">æ•°å­¦ï¼ˆå®Œå…¨AIç‰ˆï¼‰</h2>
                                            <p className="text-gray-600">ä½“ç³»æ•°å­¦æº–æ‹  + Claude AIå•é¡Œç”Ÿæˆ</p>
                                        </div>
                                    </div>
                                    <ul className="text-sm text-gray-700 space-y-1">
                                        <li>â€¢ ğŸ¤– <strong>Claude AIå•é¡Œç”Ÿæˆ</strong>ï¼ˆæ€è€ƒåŠ›é‡è¦–ï¼‰</li>
                                        <li>â€¢ ğŸ“ <strong>6æ®µéšè©³ç´°è§£èª¬</strong>ï¼ˆçœç•¥ãªã—ï¼‰</li>
                                        <li>â€¢ ğŸ¯ <strong>å­¦å¹´ãƒ»åˆ†é‡ãƒ»é›£æ˜“åº¦</strong>å®Œå…¨å¯¾å¿œ</li>
                                        <li>â€¢ ğŸ’¡ <strong>ãƒ’ãƒ³ãƒˆãƒ»åˆ†æ</strong>ä»˜ãã‚µãƒãƒ¼ãƒˆ</li>
                                    </ul>
                                    <div className="mt-4 text-sm text-blue-600">
                                        è§£ç­”æ¸ˆã¿: {mathProgress.solved} å•é¡Œ
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-6 rounded-lg shadow-lg mt-8">
                                <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">
                                    ğŸ¤– Claude AIæ©Ÿèƒ½ã®ç‰¹å¾´
                                </h3>
                                <div className="grid md:grid-cols-3 gap-4 text-sm">
                                    <div className="bg-purple-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ§ </div>
                                        <h4 className="font-bold text-purple-900 mb-1">é«˜åº¦ãªå•é¡Œç”Ÿæˆ</h4>
                                        <p className="text-purple-700">æ€è€ƒåŠ›ã‚’è¦ã™ã‚‹è‰¯è³ªãªå•é¡Œ</p>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ“–</div>
                                        <h4 className="font-bold text-blue-900 mb-1">è©³ç´°ã‚¹ãƒ†ãƒƒãƒ—è§£èª¬</h4>
                                        <p className="text-blue-700">ç†è§£ãŒæ·±ã¾ã‚‹æ®µéšçš„èª¬æ˜</p>
                                    </div>
                                    <div className="bg-green-50 p-4 rounded-lg text-center">
                                        <div className="text-2xl mb-2">ğŸ¯</div>
                                        <h4 className="font-bold text-green-900 mb-1">å®Œå…¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h4>
                                        <p className="text-green-700">å€‹äººãƒ¬ãƒ™ãƒ«ã«æœ€é©åŒ–</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex items-center gap-4 mb-6">
                            <button
                                onClick={() => setCurrentSection('menu')}
                                className="bg-white p-3 rounded-lg shadow hover:shadow-md transition-all"
                            >
                                â†©ï¸
                            </button>
                            <h1 className="text-2xl font-bold text-gray-800">
                                ğŸ¤– AIæ•°å­¦å­¦ç¿’
                            </h1>
                            <div className="text-sm text-purple-600 bg-purple-100 px-3 py-1 rounded-full">
                                Claude AIç‰ˆ
                            </div>
                        </div>

                        <MathSection />
                    </div>
                </div>
            );
        };

        ReactDOM.render(<StudyTool />, document.getElementById('root'));
    </script>
</body>
</html>